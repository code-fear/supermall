{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport DetailNavBar from \"./childComps/DetailNavBar.vue\";\nimport { getDetail, Goods, Shop, GoodsParam, getRecommend } from \"../../../network/detail\";\nimport DetailSwiper from \"./childComps/DetailSwiper.vue\";\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo.vue\";\nimport DetailShopInfo from \"./childComps/DetailShopInfo.vue\";\nimport Scroll from \"../../components/common/Scroll/Scroll.vue\";\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo.vue\";\nimport DetailParamInfo from \"./childComps/DetailParamInfo.vue\";\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo.vue\";\nimport GoodsList from \"../../components/content/goods/GoodsList.vue\";\nimport { itemListenerMixin } from \"../../common/mixin\";\nimport { debounce } from \"../../common/utils\";\nimport DetailBottomBar from \"./childComps/DetailBottomBar.vue\";\nimport BackTop from \"../../components/common/bacTop/BackTop.vue\";\nexport default {\n  name: \"Detail\",\n  components: {\n    DetailNavBar: DetailNavBar,\n    DetailSwiper: DetailSwiper,\n    DetailBaseInfo: DetailBaseInfo,\n    DetailShopInfo: DetailShopInfo,\n    Scroll: Scroll,\n    DetailGoodsInfo: DetailGoodsInfo,\n    DetailParamInfo: DetailParamInfo,\n    DetailCommentInfo: DetailCommentInfo,\n    GoodsList: GoodsList,\n    DetailBottomBar: DetailBottomBar,\n    BackTop: BackTop\n  },\n  data: function data() {\n    return {\n      iid: null,\n      topImages: [],\n      goods: {},\n      shop: {},\n      detailInfo: {},\n      paramInfo: {},\n      commentInfo: {},\n      recommendList: [],\n      itemImgListener: null,\n      themeTopYs: [],\n      getThemeTopY: null,\n      currentIndex: 0,\n      isShowBackTop: true\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    // console.log(this.$route.params);\n    this.iid = this.$route.params.iid; // 2.根据iid请求详情数据\n\n    getDetail(this.iid).then(function (res) {\n      // 1.获取顶部的图片轮播数据\n      // console.log(res);\n      var data = res.data.result;\n      _this.topImages = data.itemInfo.topImages; // 2.获取商品信息\n\n      _this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services); // 3.创建店铺信息的对象\n\n      _this.shop = new Shop(data.shopInfo); // 4.保存商品的详情数据\n\n      _this.detailInfo = data.detailInfo; // 5.获取参数的信息\n\n      _this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule); //获取评论信息\n\n      if (data.rate.cRate !== 0) {\n        _this.commentInfo = data.rate.list[0];\n      }\n\n      getRecommend().then(function (res, error) {\n        // console.log(res);\n        if (error) return;\n        _this.recommendList = res.data.data.list;\n      }); // this.getThemeTopY = debounce(() => {\n      //   this.themeTopYs = [];\n      //   this.themeTopYs.push(0);\n      //   this.themeTopYs.push(this.$refs.params.$el.offsetTop);\n      //   this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\n      //   this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\n      //   console.log(this.themeTopYs);\n      // });\n    });\n  },\n  updated: function updated() {\n    this.themeTopYs = [];\n    this.themeTopYs.push(0);\n    this.themeTopYs.push(this.$refs.params.$el.offsetTop);\n    this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\n    this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\n    console.log(this.themeTopYs);\n  },\n  methods: {\n    imageLoad: function imageLoad() {\n      this.$ref.scroll.refresh(); // this.getThemeTopY();\n    },\n    titleClick: function titleClick(index) {\n      console.log(index);\n      this.$refs.scroll.scrollTo(0, -this.themeTopYs[index], 200);\n    },\n    contentScroll: function contentScroll(position) {\n      // console.log(position);\n      //获取Y值\n      var positionY = -position.y; // 2. positoinY和主题中值进行对比\n      // [0, 7938，9120, 9452]\n      // positoinY在0和7938 之间，index = 0\n      // positoinY 在=7938 和9120之间，index = 1\n      // positoinY在9120和9452 之间，index = 2\n      // positoinY 大于等于9120值，index = 3\n\n      var length = this.themeTopYs.length;\n\n      for (var i = 0; i < length; i++) {\n        // if (positoinY > this.themeTopYs[i] && positoinY < this. themeTopYs[i+1]) {\n        //\n        // console.log(i);\n        // }\n        if (this.currentIndex !== i && (i < length - 1 && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i + 1] || i === length - 1 && positionY >= this.themeTopYs[i])) {\n          this.currentIndex = i; // console.log(this.currentIndex);\n\n          this.$refs.nav.currentIndex = this.currentIndex;\n        }\n      }\n\n      this.isShowBackTop = -position.y > 3000;\n    }\n  },\n  mixins: [itemListenerMixin],\n  mounted: function mounted() {},\n  destroyed: function destroyed() {\n    this.$bus.$off(\"itemImageLoad\", this.itemImgListener);\n  },\n  backClick: function backClick() {\n    //返回顶部\n    this.$refs.scroll.scrollTo(0, 0);\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;AAkBA;AACA,SACAA,SADA,EAEAC,KAFA,EAGAC,IAHA,EAIAC,UAJA,EAKAC,YALA,QAMA,yBANA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACAC,gBADA;AAEAC;AACAC,8BADA;AAEAC,8BAFA;AAGAC,kCAHA;AAIAC,kCAJA;AAKAC,kBALA;AAMAC,oCANA;AAOAC,oCAPA;AAQAC,wCARA;AASAC,wBATA;AAUAC,oCAVA;AAWAC;AAXA,GAFA;AAgBAC,MAhBA,kBAgBA;AACA;AACAC,eADA;AAEAC,mBAFA;AAGAC,eAHA;AAIAC,cAJA;AAKAC,oBALA;AAMAC,mBANA;AAOAC,qBAPA;AAQAC,uBARA;AASAC,2BATA;AAUAC,oBAVA;AAWAC,wBAXA;AAYAC,qBAZA;AAaAC;AAbA;AAeA,GAhCA;AAiCAC,SAjCA,qBAiCA;AAAA;;AACA;AACA,sCAFA,CAGA;;AACAhC;AACA;AACA;AACA;AACA,gDAJA,CAMA;;AACA,8BACAkB,aADA,EAEAA,YAFA,EAGAA,sBAHA,EAPA,CAaA;;AACA,2CAdA,CAgBA;;AACA,yCAjBA,CAmBA;;AACA,uCACAA,oBADA,EAEAA,oBAFA,EApBA,CAwBA;;AACA;AACA;AACA;;AACAd;AACA;AACA;AACA;AACA,OAJA,EA5BA,CAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAzCA;AA0CA,GA/EA;AAgFA6B,SAhFA,qBAgFA;AACA;AACA;AACA;AACA;AACA;AACAC;AACA,GAvFA;AAwFAC;AACAC,aADA,uBACA;AACA,iCADA,CAEA;AACA,KAJA;AAKAC,cALA,sBAKAC,KALA,EAKA;AACAJ;AACA;AACA,KARA;AASAK,iBATA,yBASAC,QATA,EASA;AACA;AACA;AACA,kCAHA,CAIA;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;AACA;AACA,YACA,4BACAC,kBACAC,+BADA,IAEAA,kCAFA,IAGAD,mDAJA,CADA,EAMA;AACA,gCADA,CAEA;;AACA;AACA;AACA;;AACA;AACA;AAtCA,GAxFA;AAgIAE,6BAhIA;AAiIAC,SAjIA,qBAiIA,EAjIA;AAkIAC,WAlIA,uBAkIA;AACA;AACA,GApIA;AAqIAC,WArIA,uBAqIA;AACA;AACA;AACA;AAxIA","names":["getDetail","Goods","Shop","GoodsParam","getRecommend","name","components","DetailNavBar","DetailSwiper","DetailBaseInfo","DetailShopInfo","Scroll","DetailGoodsInfo","DetailParamInfo","DetailCommentInfo","GoodsList","DetailBottomBar","BackTop","data","iid","topImages","goods","shop","detailInfo","paramInfo","commentInfo","recommendList","itemImgListener","themeTopYs","getThemeTopY","currentIndex","isShowBackTop","created","updated","console","methods","imageLoad","titleClick","index","contentScroll","position","i","positionY","mixins","mounted","destroyed","backClick"],"sourceRoot":"src/views/detail","sources":["Detail.vue"],"sourcesContent":["<template>\r\n  <div id=\"detail\">\r\n    <detail-nav-bar class=\"detail-nav\" @titleClick=\"titleClick\" ref=\"nav\" />\r\n    <scroll class=\"content\" ref=\"scroll\" @scroll=\"contentScroll\" :probeType=\"3\">\r\n      <detail-swiper :topImages=\"topImages\" />\r\n      <detail-base-info :goods=\"goods\" />\r\n      <detail-shop-info :shop=\"shop\" />\r\n      <detail-goods-info :detailInfo=\"detailInfo\" @click=\"imageLoad\" />\r\n      <detail-param-info :paramInfo=\"paramInfo\" ref=\"params\" />\r\n      <detail-comment-info :commentInfo=\"commentInfo\" ref=\"comment\" />\r\n      <goods-list :goods=\"recommendList\" ref=\"recommend\" />\r\n    </scroll>\r\n    <detail-bottom-bar />\r\n    <back-top @click.native=\"backClick\" v-show=\"isShowBackTop\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailNavBar from \"./childComps/DetailNavBar.vue\";\r\nimport {\r\n  getDetail,\r\n  Goods,\r\n  Shop,\r\n  GoodsParam,\r\n  getRecommend,\r\n} from \"../../../network/detail\";\r\nimport DetailSwiper from \"./childComps/DetailSwiper.vue\";\r\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo.vue\";\r\nimport DetailShopInfo from \"./childComps/DetailShopInfo.vue\";\r\nimport Scroll from \"../../components/common/Scroll/Scroll.vue\";\r\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo.vue\";\r\nimport DetailParamInfo from \"./childComps/DetailParamInfo.vue\";\r\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo.vue\";\r\nimport GoodsList from \"../../components/content/goods/GoodsList.vue\";\r\n\r\nimport { itemListenerMixin } from \"../../common/mixin\";\r\nimport { debounce } from \"../../common/utils\";\r\nimport DetailBottomBar from \"./childComps/DetailBottomBar.vue\";\r\nimport BackTop from \"../../components/common/bacTop/BackTop.vue\";\r\n\r\nexport default {\r\n  name: \"Detail\",\r\n  components: {\r\n    DetailNavBar,\r\n    DetailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    Scroll,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetailCommentInfo,\r\n    GoodsList,\r\n    DetailBottomBar,\r\n    BackTop,\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      iid: null,\r\n      topImages: [],\r\n      goods: {},\r\n      shop: {},\r\n      detailInfo: {},\r\n      paramInfo: {},\r\n      commentInfo: {},\r\n      recommendList: [],\r\n      itemImgListener: null,\r\n      themeTopYs: [],\r\n      getThemeTopY: null,\r\n      currentIndex: 0,\r\n      isShowBackTop: true,\r\n    };\r\n  },\r\n  created() {\r\n    // console.log(this.$route.params);\r\n    this.iid = this.$route.params.iid;\r\n    // 2.根据iid请求详情数据\r\n    getDetail(this.iid).then((res) => {\r\n      // 1.获取顶部的图片轮播数据\r\n      // console.log(res);\r\n      const data = res.data.result;\r\n      this.topImages = data.itemInfo.topImages;\r\n\r\n      // 2.获取商品信息\r\n      this.goods = new Goods(\r\n        data.itemInfo,\r\n        data.columns,\r\n        data.shopInfo.services\r\n      );\r\n\r\n      // 3.创建店铺信息的对象\r\n      this.shop = new Shop(data.shopInfo);\r\n\r\n      // 4.保存商品的详情数据\r\n      this.detailInfo = data.detailInfo;\r\n\r\n      // 5.获取参数的信息\r\n      this.paramInfo = new GoodsParam(\r\n        data.itemParams.info,\r\n        data.itemParams.rule\r\n      );\r\n      //获取评论信息\r\n      if (data.rate.cRate !== 0) {\r\n        this.commentInfo = data.rate.list[0];\r\n      }\r\n      getRecommend().then((res, error) => {\r\n        // console.log(res);\r\n        if (error) return;\r\n        this.recommendList = res.data.data.list;\r\n      });\r\n      // this.getThemeTopY = debounce(() => {\r\n      //   this.themeTopYs = [];\r\n      //   this.themeTopYs.push(0);\r\n      //   this.themeTopYs.push(this.$refs.params.$el.offsetTop);\r\n      //   this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\r\n      //   this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\r\n      //   console.log(this.themeTopYs);\r\n      // });\r\n    });\r\n  },\r\n  updated() {\r\n    this.themeTopYs = [];\r\n    this.themeTopYs.push(0);\r\n    this.themeTopYs.push(this.$refs.params.$el.offsetTop);\r\n    this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\r\n    this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\r\n    console.log(this.themeTopYs);\r\n  },\r\n  methods: {\r\n    imageLoad() {\r\n      this.$ref.scroll.refresh();\r\n      // this.getThemeTopY();\r\n    },\r\n    titleClick(index) {\r\n      console.log(index);\r\n      this.$refs.scroll.scrollTo(0, -this.themeTopYs[index], 200);\r\n    },\r\n    contentScroll(position) {\r\n      // console.log(position);\r\n      //获取Y值\r\n      const positionY = -position.y;\r\n      // 2. positoinY和主题中值进行对比\r\n      // [0, 7938，9120, 9452]\r\n      // positoinY在0和7938 之间，index = 0\r\n      // positoinY 在=7938 和9120之间，index = 1\r\n      // positoinY在9120和9452 之间，index = 2\r\n      // positoinY 大于等于9120值，index = 3\r\n      let length = this.themeTopYs.length;\r\n      for (let i = 0; i < length; i++) {\r\n        // if (positoinY > this.themeTopYs[i] && positoinY < this. themeTopYs[i+1]) {\r\n        //\r\n        // console.log(i);\r\n        // }\r\n        if (\r\n          this.currentIndex !== i &&\r\n          ((i < length - 1 &&\r\n            positionY >= this.themeTopYs[i] &&\r\n            positionY < this.themeTopYs[i + 1]) ||\r\n            (i === length - 1 && positionY >= this.themeTopYs[i]))\r\n        ) {\r\n          this.currentIndex = i;\r\n          // console.log(this.currentIndex);\r\n          this.$refs.nav.currentIndex = this.currentIndex;\r\n        }\r\n      }\r\n      this.isShowBackTop = -position.y > 3000;\r\n    },\r\n  },\r\n  mixins: [itemListenerMixin],\r\n  mounted() {},\r\n  destroyed() {\r\n    this.$bus.$off(\"itemImageLoad\", this.itemImgListener);\r\n  },\r\n  backClick() {\r\n    //返回顶部\r\n    this.$refs.scroll.scrollTo(0, 0);\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n#detail {\r\n  position: relative;\r\n  z-index: 999;\r\n  background-color: #fff;\r\n  height: 100vh;\r\n}\r\n\r\n.detail-nav {\r\n  position: relative;\r\n  z-index: 999;\r\n  background-color: #fff;\r\n}\r\n\r\n.content {\r\n  height: calc(100% - 44px);\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}